<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        padding: 30px;
      }

      .title {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
        font-size: 2em;
      }

      .mode-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        gap: 10px;
      }

      .tab-btn {
        padding: 12px 24px;
        background: #ecf0f1;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        color: #7f8c8d;
        transition: all 0.3s ease;
      }

      .tab-btn.active {
        background: #2360A1;
        color: white;
      }

      .tab-btn:hover {
        background: #97AFAE;
        color: white;
      }

      .tab-btn.active:hover {
        background: #1a4d85;
      }

      .atom-selection {
        display: flex;
        flex-direction: column;
        margin-bottom: 30px;
        align-items: center;
      }

      .atom-selector {
        text-align: center;
      }

      .atom-selector label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
        color: #34495e;
      }

      .element-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-bottom: 15px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .element-box {
        width: 55px;
        height: 55px;
        border: 3px solid #bdc3c7;
        border-radius: 8px;
        background: #ecf0f1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
      }

      .element-box:hover {
        border-color: #F2A128;
        background: #fdf4e5;
        transform: translateY(-2px);
      }

      .element-box.selected {
        border-color: #2360A1;
        background: #2360A1;
        color: white;
      }

      .element-symbol {
        font-size: 16px;
        font-weight: bold;
      }

      .element-name {
        font-size: 7px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .atom-selector-visual {
        text-align: center;
        margin-bottom: 20px;
      }

      .atom-selector-visual label {
        display: block;
        margin-bottom: 15px;
        font-weight: bold;
        color: #34495e;
        font-size: 16px;
      }

      select {
        padding: 10px;
        font-size: 16px;
        border: 2px solid #2360A1;
        border-radius: 5px;
        background: white;
        color: #2c3e50;
      }

      .custom-controls {
        display: none;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 30px;
      }

      .slider-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
      }

      .slider-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .slider-label {
        font-weight: bold;
        color: #2c3e50;
        font-size: 18px;
      }

      .en-slider {
        width: 200px;
        height: 8px;
        border-radius: 5px;
        background: #ddd;
        outline: none;
        -webkit-appearance: none;
      }

      .en-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #2360A1;
        cursor: pointer;
      }

      .en-slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #2360A1;
        cursor: pointer;
        border: none;
      }

      .en-value {
        font-size: 16px;
        font-weight: bold;
        color: #2c3e50;
        min-width: 40px;
        text-align: center;
      }

      .bond-container {
        position: relative;
        height: 300px;
        margin: 40px 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .electron-cloud {
        position: absolute;
        width: 450px;
        height: 200px;
        border-radius: 50%;
        opacity: 0.6;
        transition: all 0.5s ease;
        z-index: 5;
      }

      /* New ionic cloud styles */
      .ionic-cloud-left {
        position: absolute;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        opacity: 0.8;
        transition: all 0.5s ease;
        z-index: 5;
        left: 50%;
        transform: translateX(-185px);
        display: none;
      }

      .ionic-cloud-right {
        position: absolute;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        opacity: 0.8;
        transition: all 0.5s ease;
        z-index: 5;
        left: 50%;
        transform: translateX(65px);
        display: none;
      }

      .atom {
        position: absolute;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        color: white;
        background: #2c3e50;
        z-index: 15;
      }

      .atom1 {
        left: 50%;
        transform: translateX(-125px);
      }

      .atom2 {
        left: 50%;
        transform: translateX(85px);
      }

      .bond-line {
        display: none;
      }

      .charge-symbol {
        position: absolute;
        font-weight: bold;
        color: #2c3e50;
        transition: all 0.5s ease;
        z-index: 15;
      }

      .charge-left {
        left: 80px;
        top: 30px;
      }

      .charge-right {
        right: 80px;
        top: 30px;
      }

      .info-panel {
        display: flex;
        justify-content: space-around;
        margin-top: 30px;
        text-align: center;
      }

      .info-item {
        background: #ecf0f1;
        padding: 15px;
        border-radius: 10px;
        min-width: 120px;
      }

      .info-label {
        font-weight: bold;
        color: #7f8c8d;
        font-size: 12px;
        text-transform: uppercase;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 18px;
        color: #2c3e50;
        font-weight: bold;
        padding: 8px 12px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .bond-type {
        background: #2360A1 !important;
        color: white !important;
        padding: 20px;
        border-radius: 10px;
        font-size: 20px;
        font-weight: bold;
        text-align: center;
        margin-top: 20px;
        transition: all 0.3s ease;
      }

      .bond-type.hidden {
        display: none;
      }

      .checkbox-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 15px;
        gap: 10px;
      }

      .checkbox-container input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .checkbox-container label {
        font-weight: bold;
        color: #2c3e50;
        cursor: pointer;
      }

      .view-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 15px 0;
        gap: 10px;
      }

      .toggle-btn {
        padding: 8px 16px;
        background: #ecf0f1;
        border: 2px solid #bdc3c7;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        color: #7f8c8d;
        transition: all 0.3s ease;
        position: relative;
      }

      .toggle-btn.active {
        background: #2360A1;
        border-color: #2360A1;
        color: white;
      }

      .toggle-btn:hover {
        border-color: #F2A128;
        background: #fdf4e5;
      }

      .toggle-btn.active:hover {
        background: #1a4d85;
        border-color: #1a4d85;
      }

      .info-icon {
        margin-left: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        user-select: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #97AFAE;
        border: 2px solid #97AFAE;
        position: relative;
      }

      .info-icon::before {
        content: "";
        width: 2px;
        height: 8px;
        background: white;
        border-radius: 1px;
        position: absolute;
        top: 6px;
      }

      .info-icon::after {
        content: "";
        width: 2px;
        height: 2px;
        background: white;
        border-radius: 50%;
        position: absolute;
        top: 2px;
      }

      .toggle-btn.active .info-icon {
        background: #ffffff;
        border-color: #97AFAE;
      }

      .toggle-btn.active .info-icon::before,
      .toggle-btn.active .info-icon::after {
        background: #97AFAE;
      }

      .info-icon:hover {
        background: #F2A128;
        border-color: #F2A128;
        transform: scale(1.1);
      }

      .toggle-btn.active .info-icon:hover {
        background: #97AFAE;
        border-color: #F2A128;
        transform: scale(1.1);
      }

      .toggle-btn.active .info-icon:hover::before,
      .toggle-btn.active .info-icon:hover::after {
        background: white;
      }

      .electron-dots-view {
        position: absolute;
        width: 450px;
        height: 200px;
        border-radius: 50%;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        opacity: 0.8;
        transition: all 0.5s ease;
        z-index: 5;
        display: none;
      }

      .electron-dot {
        position: absolute;
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
        transition: all 0.1s ease;
        z-index: 20;
      }

      /* Modal Styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 12px;
        padding: 25px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s ease;
      }

      /* Tour Styles */
      .tour-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.2);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      }

      .tour-callout {
        position: fixed;
        background: white;
        border-radius: 12px;
        padding: 20px;
        max-width: 280px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        border: 3px solid #97AFAE;
        z-index: 1001;
        animation: slideIn 0.3s ease;
      }

      .tour-callout::before {
        content: "";
        position: absolute;
        width: 0;
        height: 0;
        border: 12px solid transparent;
      }

      .tour-callout.point-left::before {
        border-right-color: #97AFAE;
        left: -27px;
        top: 50%;
        transform: translateY(-50%);
      }

      .tour-callout.point-right::before {
        border-left-color: #97AFAE;
        right: -27px;
        top: 50%;
        transform: translateY(-50%);
      }

      .tour-callout.point-up::before {
        border-bottom-color: #97AFAE;
        top: -27px;
        left: 50%;
        transform: translateX(-50%);
      }

      .tour-callout.point-down::before {
        border-top-color: #97AFAE;
        bottom: -27px;
        left: 50%;
        transform: translateX(-50%);
      }

      .tour-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 15px;
      }

      .tour-title {
        font-size: 16px;
        font-weight: bold;
        color: #2c3e50;
        margin: 0;
        flex-grow: 1;
      }

      .tour-close {
        background: none;
        border: none;
        font-size: 18px;
        color: #7f8c8d;
        cursor: pointer;
        padding: 0;
        margin-left: 10px;
      }

      .tour-close:hover {
        color: #2c3e50;
      }

      .tour-content {
        color: #34495e;
        line-height: 1.5;
        margin-bottom: 15px;
        font-size: 14px;
      }

      .tour-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
      }

      .tour-counter {
        font-size: 12px;
        color: #7f8c8d;
      }

      .tour-buttons {
        display: flex;
        gap: 8px;
      }

      .tour-btn {
        padding: 6px 12px;
        border: 1px solid #bdc3c7;
        border-radius: 6px;
        background: #ecf0f1;
        color: #234568;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s ease;
      }

      .tour-btn:hover {
        background: #97AFAE;
        border-color: #97AFAE;
        color: white;
      }

      .tour-btn.primary {
        background: #2360A1;
        border-color: #2360A1;
        color: white;
      }

      .tour-btn.primary:hover {
        background: #1a4d85;
        border-color: #1a4d85;
      }

      .tour-highlight {
        display: none !important; /* Hide the green highlighting box */
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ecf0f1;
      }

      .modal-title {
        font-size: 20px;
        font-weight: bold;
        color: #2c3e50;
        margin: 0;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #7f8c8d;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        background: #ecf0f1;
        color: #2c3e50;
      }

      .modal-body {
        color: #34495e;
        line-height: 1.6;
        font-size: 16px;
      }

      .modal-body p {
        margin-bottom: 15px;
      }

      .modal-body .highlight {
        font-weight: bold;
        color: #2c3e50;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translate(-50%, -60%);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%);
        }
      }

      .ionic {
        background: #e74c3c !important;
      }
      .polar {
        background: #F2A128 !important;
      }
      .nonpolar {
        background: #97AFAE !important;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="mode-tabs">
        <button class="tab-btn active" onclick="switchMode('intro')">
          Getting Started
        </button>
        <button class="tab-btn" onclick="switchMode('atoms')">
          Explore More Elements
        </button>
        <button class="tab-btn" onclick="switchMode('custom')">
          Experiment with Custom Values
        </button>
      </div>

      <div class="atom-selection" id="intro-mode">
        <div class="atom-selector-visual">
          <label>Choose an atom (first atom):</label>
          <div class="element-grid">
            <div
              class="element-box selected"
              data-element="H"
              onclick="selectAtom('intro-atom1', 'H', this)"
            >
              <div class="element-symbol">H</div>
              <div class="element-name">Hydrogen</div>
            </div>
            <div
              class="element-box"
              data-element="C"
              onclick="selectAtom('intro-atom1', 'C', this)"
            >
              <div class="element-symbol">C</div>
              <div class="element-name">Carbon</div>
            </div>
            <div
              class="element-box"
              data-element="N"
              onclick="selectAtom('intro-atom1', 'N', this)"
            >
              <div class="element-symbol">N</div>
              <div class="element-name">Nitrogen</div>
            </div>
            <div
              class="element-box"
              data-element="O"
              onclick="selectAtom('intro-atom1', 'O', this)"
            >
              <div class="element-symbol">O</div>
              <div class="element-name">Oxygen</div>
            </div>
            <div
              class="element-box"
              data-element="F"
              onclick="selectAtom('intro-atom1', 'F', this)"
            >
              <div class="element-symbol">F</div>
              <div class="element-name">Fluorine</div>
            </div>
            <div
              class="element-box"
              data-element="S"
              onclick="selectAtom('intro-atom1', 'S', this)"
            >
              <div class="element-symbol">S</div>
              <div class="element-name">Sulfur</div>
            </div>
            <div
              class="element-box"
              data-element="Cl"
              onclick="selectAtom('intro-atom1', 'Cl', this)"
            >
              <div class="element-symbol">Cl</div>
              <div class="element-name">Chlorine</div>
            </div>
          </div>
        </div>

        <div class="atom-selector-visual">
          <label>Choose an atom (second atom):</label>
          <div class="element-grid">
            <div
              class="element-box"
              data-element="H"
              onclick="selectAtom('intro-atom2', 'H', this)"
            >
              <div class="element-symbol">H</div>
              <div class="element-name">Hydrogen</div>
            </div>
            <div
              class="element-box"
              data-element="C"
              onclick="selectAtom('intro-atom2', 'C', this)"
            >
              <div class="element-symbol">C</div>
              <div class="element-name">Carbon</div>
            </div>
            <div
              class="element-box"
              data-element="N"
              onclick="selectAtom('intro-atom2', 'N', this)"
            >
              <div class="element-symbol">N</div>
              <div class="element-name">Nitrogen</div>
            </div>
            <div
              class="element-box"
              data-element="O"
              onclick="selectAtom('intro-atom2', 'O', this)"
            >
              <div class="element-symbol">O</div>
              <div class="element-name">Oxygen</div>
            </div>
            <div
              class="element-box selected"
              data-element="F"
              onclick="selectAtom('intro-atom2', 'F', this)"
            >
              <div class="element-symbol">F</div>
              <div class="element-name">Fluorine</div>
            </div>
            <div
              class="element-box"
              data-element="S"
              onclick="selectAtom('intro-atom2', 'S', this)"
            >
              <div class="element-symbol">S</div>
              <div class="element-name">Sulfur</div>
            </div>
            <div
              class="element-box"
              data-element="Cl"
              onclick="selectAtom('intro-atom2', 'Cl', this)"
            >
              <div class="element-symbol">Cl</div>
              <div class="element-name">Chlorine</div>
            </div>
          </div>
        </div>
      </div>

      <div class="atom-selection" id="atom-mode" style="display: none">
        <div class="atom-selector-visual">
          <label>Choose an atom (first atom):</label>
          <div class="element-grid">
            <div
              class="element-box selected"
              data-element="H"
              onclick="selectAtom('full-atom1', 'H', this)"
            >
              <div class="element-symbol">H</div>
              <div class="element-name">Hydrogen</div>
            </div>
            <div
              class="element-box"
              data-element="Li"
              onclick="selectAtom('full-atom1', 'Li', this)"
            >
              <div class="element-symbol">Li</div>
              <div class="element-name">Lithium</div>
            </div>
            <div
              class="element-box"
              data-element="C"
              onclick="selectAtom('full-atom1', 'C', this)"
            >
              <div class="element-symbol">C</div>
              <div class="element-name">Carbon</div>
            </div>
            <div
              class="element-box"
              data-element="N"
              onclick="selectAtom('full-atom1', 'N', this)"
            >
              <div class="element-symbol">N</div>
              <div class="element-name">Nitrogen</div>
            </div>
            <div
              class="element-box"
              data-element="O"
              onclick="selectAtom('full-atom1', 'O', this)"
            >
              <div class="element-symbol">O</div>
              <div class="element-name">Oxygen</div>
            </div>
            <div
              class="element-box"
              data-element="F"
              onclick="selectAtom('full-atom1', 'F', this)"
            >
              <div class="element-symbol">F</div>
              <div class="element-name">Fluorine</div>
            </div>
            <div
              class="element-box"
              data-element="Na"
              onclick="selectAtom('full-atom1', 'Na', this)"
            >
              <div class="element-symbol">Na</div>
              <div class="element-name">Sodium</div>
            </div>
            <div
              class="element-box"
              data-element="Mg"
              onclick="selectAtom('full-atom1', 'Mg', this)"
            >
              <div class="element-symbol">Mg</div>
              <div class="element-name">Magnesium</div>
            </div>
            <div
              class="element-box"
              data-element="Al"
              onclick="selectAtom('full-atom1', 'Al', this)"
            >
              <div class="element-symbol">Al</div>
              <div class="element-name">Aluminum</div>
            </div>
            <div
              class="element-box"
              data-element="Si"
              onclick="selectAtom('full-atom1', 'Si', this)"
            >
              <div class="element-symbol">Si</div>
              <div class="element-name">Silicon</div>
            </div>
            <div
              class="element-box"
              data-element="P"
              onclick="selectAtom('full-atom1', 'P', this)"
            >
              <div class="element-symbol">P</div>
              <div class="element-name">Phosphorus</div>
            </div>
            <div
              class="element-box"
              data-element="S"
              onclick="selectAtom('full-atom1', 'S', this)"
            >
              <div class="element-symbol">S</div>
              <div class="element-name">Sulfur</div>
            </div>
            <div
              class="element-box"
              data-element="Cl"
              onclick="selectAtom('full-atom1', 'Cl', this)"
            >
              <div class="element-symbol">Cl</div>
              <div class="element-name">Chlorine</div>
            </div>
            <div
              class="element-box"
              data-element="K"
              onclick="selectAtom('full-atom1', 'K', this)"
            >
              <div class="element-symbol">K</div>
              <div class="element-name">Potassium</div>
            </div>
            <div
              class="element-box"
              data-element="Ca"
              onclick="selectAtom('full-atom1', 'Ca', this)"
            >
              <div class="element-symbol">Ca</div>
              <div class="element-name">Calcium</div>
            </div>
            <div
              class="element-box"
              data-element="Br"
              onclick="selectAtom('full-atom1', 'Br', this)"
            >
              <div class="element-symbol">Br</div>
              <div class="element-name">Bromine</div>
            </div>
          </div>
        </div>

        <div class="atom-selector-visual">
          <label>Choose an atom (second atom):</label>
          <div class="element-grid">
            <div
              class="element-box"
              data-element="H"
              onclick="selectAtom('full-atom2', 'H', this)"
            >
              <div class="element-symbol">H</div>
              <div class="element-name">Hydrogen</div>
            </div>
            <div
              class="element-box"
              data-element="C"
              onclick="selectAtom('full-atom2', 'C', this)"
            >
              <div class="element-symbol">C</div>
              <div class="element-name">Carbon</div>
            </div>
            <div
              class="element-box"
              data-element="N"
              onclick="selectAtom('full-atom2', 'N', this)"
            >
              <div class="element-symbol">N</div>
              <div class="element-name">Nitrogen</div>
            </div>
            <div
              class="element-box"
              data-element="O"
              onclick="selectAtom('full-atom2', 'O', this)"
            >
              <div class="element-symbol">O</div>
              <div class="element-name">Oxygen</div>
            </div>
            <div
              class="element-box selected"
              data-element="F"
              onclick="selectAtom('full-atom2', 'F', this)"
            >
              <div class="element-symbol">F</div>
              <div class="element-name">Fluorine</div>
            </div>
            <div
              class="element-box"
              data-element="Si"
              onclick="selectAtom('full-atom2', 'Si', this)"
            >
              <div class="element-symbol">Si</div>
              <div class="element-name">Silicon</div>
            </div>
            <div
              class="element-box"
              data-element="P"
              onclick="selectAtom('full-atom2', 'P', this)"
            >
              <div class="element-symbol">P</div>
              <div class="element-name">Phosphorus</div>
            </div>
            <div
              class="element-box"
              data-element="S"
              onclick="selectAtom('full-atom2', 'S', this)"
            >
              <div class="element-symbol">S</div>
              <div class="element-name">Sulfur</div>
            </div>
            <div
              class="element-box"
              data-element="Cl"
              onclick="selectAtom('full-atom2', 'Cl', this)"
            >
              <div class="element-symbol">Cl</div>
              <div class="element-name">Chlorine</div>
            </div>
            <div
              class="element-box"
              data-element="Br"
              onclick="selectAtom('full-atom2', 'Br', this)"
            >
              <div class="element-symbol">Br</div>
              <div class="element-name">Bromine</div>
            </div>
          </div>
        </div>
      </div>

      <div class="custom-controls" id="custom-mode">
        <div class="slider-container">
          <div class="slider-group">
            <div class="slider-label">Atom A</div>
            <input
              type="range"
              class="en-slider"
              id="en-slider-1"
              min="0.5"
              max="4.0"
              step="0.01"
              value="2.20"
            />
            <div class="en-value" id="en-value-1">2.20</div>
          </div>
          <div class="slider-group">
            <div class="slider-label">Atom B</div>
            <input
              type="range"
              class="en-slider"
              id="en-slider-2"
              min="0.5"
              max="4.0"
              step="0.01"
              value="3.98"
            />
            <div class="en-value" id="en-value-2">3.98</div>
          </div>
        </div>
      </div>

      <div class="view-toggle" id="view-toggle">
        <div class="toggle-btn active" onclick="switchView('cloud')">
          Charge Distribution View
          <span
            class="info-icon"
            onclick="event.stopPropagation(); startTour('charge')"
          ></span>
        </div>
        <div class="toggle-btn" onclick="switchView('dots')">
          Moving Electrons View
          <span
            class="info-icon"
            onclick="event.stopPropagation(); showModal('electrons-modal')"
          ></span>
        </div>
      </div>

      <div class="bond-container">
        <div class="electron-cloud" id="electron-cloud"></div>
        <!-- New ionic clouds -->
        <div class="ionic-cloud-left" id="ionic-cloud-left"></div>
        <div class="ionic-cloud-right" id="ionic-cloud-right"></div>
        <div class="electron-dots-view" id="electron-dots-view">
          <div class="electron-dot" id="electron-1"></div>
          <div class="electron-dot" id="electron-2"></div>
        </div>
        <div class="bond-line"></div>
        <div class="atom atom1" id="atom1">H</div>
        <div class="atom atom2" id="atom2">F</div>
        <div class="charge-symbol charge-left" id="charge-left"></div>
        <div class="charge-symbol charge-right" id="charge-right"></div>
      </div>

      <div class="info-panel">
        <div class="info-item">
          <div class="info-label">Atom A<br />Electronegativity</div>
          <div class="info-value" id="en1">2.20</div>
        </div>
        <div class="info-item">
          <div class="info-label">Electronegativity<br />Difference</div>
          <div class="info-value" id="en-diff">1.7</div>
        </div>
        <div class="info-item">
          <div class="info-label">Atom B<br />Electronegativity</div>
          <div class="info-value" id="en2">3.98</div>
        </div>
      </div>

      <div class="checkbox-container">
        <input type="checkbox" id="show-bond-type" checked />
        <label for="show-bond-type">Show Bond Type Classification</label>
      </div>

      <div class="bond-type" id="bond-type">Polar Covalent</div>
    </div>

    <!-- Tour System -->
    <div class="tour-overlay" id="tour-overlay" onclick="closeTour(event)">
      <div class="tour-highlight" id="tour-highlight"></div>
      <div
        class="tour-callout"
        id="tour-callout"
        onclick="event.stopPropagation()"
      >
        <div class="tour-header">
          <h4 class="tour-title" id="tour-title">Step 1 of 4</h4>
          <button class="tour-close" onclick="closeTour()">&times;</button>
        </div>
        <div class="tour-content" id="tour-content">Content goes here</div>
        <div class="tour-navigation">
          <div class="tour-counter" id="tour-counter">1 / 4</div>
          <div class="tour-buttons">
            <button class="tour-btn" id="tour-prev" onclick="prevTourStep()">
              Previous
            </button>
            <button
              class="tour-btn primary"
              id="tour-next"
              onclick="nextTourStep()"
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="charge-modal" onclick="closeModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h3 class="modal-title">Charge Distribution View</h3>
          <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            This view shows how electric charge is distributed across the
            molecule's surface.
          </p>
          <p>
            <span class="highlight">Areas with partial positive charge</span>
            are shaded in
            <span style="color: #0064ff; font-weight: bold">blue</span>, with
            greater charge represented by more intense blue coloring.
          </p>
          <p>
            <span class="highlight">Areas with partial negative charge</span>
            are shaded in
            <span style="color: #ff0000; font-weight: bold">red</span>, with
            greater charge represented by more intense red coloring.
          </p>
          <p>
            <span class="highlight">Areas with no charge separation</span> are
            represented with a neutral gray color or lack of coloring.
          </p>
          <p>
            <span class="highlight">The δ (delta) symbols</span> indicate
            partial charges: δ+ means partial positive charge and δ− means
            partial negative charge. These symbols show which atom pulls
            electrons more strongly in the bond.
          </p>
          <p>
            The intensity of the colors indicates the strength of the charge
            separation - stronger colors mean greater polarity.
          </p>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="electrons-modal" onclick="closeModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h3 class="modal-title">Moving Electrons View</h3>
          <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            This view shows the dynamic behavior of electrons in the chemical
            bond.
            <span class="highlight"
              >White dots represent individual electrons</span
            >
            that move around both atoms participating in forming the bond.
          </p>
          <p>
            <span class="highlight">The dark background</span> represents the
            overall electron cloud region.
          </p>
          </p>
        </div>
      </div>
    </div>

    <script>
      const electronegativity = {
        H: 2.2,
        Li: 0.98,
        C: 2.55,
        N: 3.04,
        O: 3.44,
        F: 3.98,
        Na: 0.93,
        Mg: 1.31,
        Al: 1.61,
        Si: 1.9,
        P: 2.19,
        S: 2.58,
        Cl: 3.16,
        K: 0.82,
        Ca: 1.0,
        Br: 2.96,
        I: 2.66,
      };

      let currentMode = "intro";
      let currentTourStep = 0;
      let tourSteps = [];

      function startTour(tourType) {
        if (tourType === "charge") {
          // Make sure we're in the right view
          if (currentView !== "cloud") {
            switchView("cloud");
          }

          // Set up tour steps for charge distribution
          tourSteps = [
            {
              title: "Partial Negative Charge",
              content:
                "Areas shaded in <strong style='color: #ff0000;'>red</strong> represent regions that have partial negative charge.",
              target: "electron-cloud",
              position: "right",
            },
            {
              title: "Partial Positive Charge",
              content:
                "Areas shaded in <strong style='color: #0064ff;'>blue</strong> represent regions that have a partial positive charge.",
              target: "electron-cloud",
              position: "left",
            },
            {
              title: "Delta Symbols",
              content:
                "The <strong>δ (delta) symbols</strong> indicate partial charges.",
              target: "charge-left",
              position: "up",
            },
            {
              title: "Gray Areas",
              content:
                "<strong style='color: #95a5a6;'>Gray areas</strong> are regions with no charge.",
              target: "intro-mode",
              position: "up",
            },
          ];
        }

        currentTourStep = 0;
        showTourStep();
        document.getElementById("tour-overlay").style.display = "block";
      }

      function showTourStep() {
        const step = tourSteps[currentTourStep];
        const callout = document.getElementById("tour-callout");

        // Update content
        document.getElementById("tour-title").textContent = step.title;
        document.getElementById("tour-content").innerHTML = step.content;
        document.getElementById("tour-counter").textContent = `${
          currentTourStep + 1
        } / ${tourSteps.length}`;

        // Update navigation buttons
        document.getElementById("tour-prev").style.display =
          currentTourStep > 0 ? "inline-block" : "none";
        document.getElementById("tour-next").textContent =
          currentTourStep < tourSteps.length - 1 ? "Next" : "Finish";

        // Position callout (no highlight positioning needed)
        positionTourElements(step);
      }

      function positionTourElements(step) {
        const callout = document.getElementById("tour-callout");
        const target = document.getElementById(step.target);

        if (!target) return;

        const targetRect = target.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;

        // Reset callout classes
        callout.className = "tour-callout";
        callout.style.position = "fixed";

        // Position callout based on step position
        let calloutLeft, calloutTop;
        const calloutWidth = 280;
        const calloutHeight = 160;

        switch (step.position) {
          case "right":
            calloutLeft = targetRect.right + 20;
            calloutTop =
              targetRect.top + targetRect.height / 2 - calloutHeight / 2;
            callout.classList.add("point-left");

            // Keep on screen
            if (calloutLeft + calloutWidth > viewportWidth) {
              calloutLeft = targetRect.left - calloutWidth - 20;
              callout.className = "tour-callout point-right";
            }
            break;

          case "left":
            calloutLeft = targetRect.left - calloutWidth - 20;
            calloutTop =
              targetRect.top + targetRect.height / 2 - calloutHeight / 2;
            callout.classList.add("point-right");

            // Keep on screen
            if (calloutLeft < 20) {
              calloutLeft = targetRect.right + 20;
              callout.className = "tour-callout point-left";
            }
            break;

          case "up":
            calloutLeft =
              targetRect.left + targetRect.width / 2 - calloutWidth / 2;
            calloutTop = targetRect.top - calloutHeight - 10;
            callout.classList.add("point-down");

            // Keep on screen
            if (calloutTop < 20) {
              calloutTop = targetRect.bottom + 20;
              callout.className = "tour-callout point-up";
            }
            break;

          case "down":
            calloutLeft =
              targetRect.left + targetRect.width / 2 - calloutWidth / 2;
            calloutTop = targetRect.bottom + 20;
            callout.classList.add("point-up");

            // Keep on screen
            if (calloutTop + calloutHeight > viewportHeight) {
              calloutTop = targetRect.top - calloutHeight - 20;
              callout.className = "tour-callout point-down";
            }
            break;
        }

        // Final boundary checks
        calloutLeft = Math.max(
          20,
          Math.min(calloutLeft, viewportWidth - calloutWidth - 20)
        );
        calloutTop = Math.max(
          20,
          Math.min(calloutTop, viewportHeight - calloutHeight - 20)
        );

        callout.style.left = calloutLeft + "px";
        callout.style.top = calloutTop + "px";
      }

      function nextTourStep() {
        if (currentTourStep < tourSteps.length - 1) {
          currentTourStep++;
          showTourStep();
        } else {
          closeTour();
        }
      }

      function prevTourStep() {
        if (currentTourStep > 0) {
          currentTourStep--;
          showTourStep();
        }
      }

      function closeTour(event) {
        if (event && event.target.classList.contains("tour-callout")) {
          return;
        }
        document.getElementById("tour-overlay").style.display = "none";
      }

      function switchMode(mode) {
        currentMode = mode;

        // Update tab buttons
        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Show/hide appropriate controls
        const introMode = document.getElementById("intro-mode");
        const atomMode = document.getElementById("atom-mode");
        const customMode = document.getElementById("custom-mode");
        const viewToggle = document.getElementById("view-toggle");

        // Hide all modes first
        introMode.style.display = "none";
        atomMode.style.display = "none";
        customMode.style.display = "none";
        viewToggle.style.display = "none";

        // Stop electron animation when switching modes
        if (electronAnimation) {
          cancelAnimationFrame(electronAnimation);
          electronAnimation = null;
        }

        // Reset to cloud view
        currentView = "cloud";
        document.getElementById("electron-cloud").style.display = "block";
        document.getElementById("electron-dots-view").style.display = "none";
        document.getElementById("ionic-cloud-left").style.display = "none";
        document.getElementById("ionic-cloud-right").style.display = "none";
        document.querySelectorAll(".toggle-btn").forEach((btn, index) => {
          btn.classList.toggle("active", index === 0);
        });

        if (mode === "intro") {
          introMode.style.display = "flex";
          viewToggle.style.display = "flex";
          updateBondFromIntro();
        } else if (mode === "atoms") {
          atomMode.style.display = "flex";
          updateBondFromFull();
        } else {
          customMode.style.display = "flex";
          updateBondFromSliders();
        }
      }

      function showModal(modalId) {
        document.getElementById(modalId).style.display = "block";
      }

      function closeModal(event) {
        if (event && event.target.classList.contains("modal-content")) {
          return; // Don't close if clicking on modal content
        }
        document.querySelectorAll(".modal-overlay").forEach((modal) => {
          modal.style.display = "none";
        });
      }

      // Close modal/tour on Escape key
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeModal();
          closeTour();
        }
      });

      // Reposition tour on window resize
      window.addEventListener("resize", function () {
        if (
          document.getElementById("tour-overlay").style.display === "block" &&
          tourSteps.length > 0
        ) {
          setTimeout(
            () => positionTourElements(tourSteps[currentTourStep]),
            100
          );
        }
      });

      function updateBondTypeVisibility() {
        const checkbox = document.getElementById("show-bond-type");
        const bondType = document.getElementById("bond-type");

        if (checkbox.checked) {
          bondType.classList.remove("hidden");
        } else {
          bondType.classList.add("hidden");
        }
      }

      function updateBondVisualization(
        en1,
        en2,
        atom1Symbol = "A",
        atom2Symbol = "B"
      ) {
        const diff = Math.abs(en2 - en1);

        // Update atom symbols
        document.getElementById("atom1").textContent = atom1Symbol;
        document.getElementById("atom2").textContent = atom2Symbol;

        // Update electronegativity values
        document.getElementById("en1").textContent = en1.toFixed(2);
        document.getElementById("en2").textContent = en2.toFixed(2);
        document.getElementById("en-diff").textContent = diff.toFixed(2);

        // Update labels with actual atom names
        const atomNames = {
          H: "Hydrogen",
          Li: "Lithium",
          C: "Carbon",
          N: "Nitrogen",
          O: "Oxygen",
          F: "Fluorine",
          Na: "Sodium",
          Mg: "Magnesium",
          Al: "Aluminum",
          Si: "Silicon",
          P: "Phosphorus",
          S: "Sulfur",
          Cl: "Chlorine",
          K: "Potassium",
          Ca: "Calcium",
          Br: "Bromine",
          I: "Iodine",
        };

        const atom1Name = atomNames[atom1Symbol] || atom1Symbol;
        const atom2Name = atomNames[atom2Symbol] || atom2Symbol;

        document.querySelector(
          ".info-panel .info-item:first-child .info-label"
        ).innerHTML = `${atom1Name}<br>Electronegativity`;
        document.querySelector(
          ".info-panel .info-item:last-child .info-label"
        ).innerHTML = `${atom2Name}<br>Electronegativity`;

        // Color the difference value based on magnitude
        const diffElement = document.getElementById("en-diff");
        const maxDiff = 3.2; // Approximate max difference (K vs F)
        const intensity = Math.min(diff / maxDiff, 1); // Scale 0-1

        if (diff < 0.001) {
          // Zero difference - neutral gray
          diffElement.style.background = "#95a5a6";
          diffElement.style.color = "white";
        } else {
          // Scale from light gray to bright red
          const r = Math.round(149 + (255 - 149) * intensity); // 149 to 255 (red)
          const g = Math.round(165 + (0 - 165) * intensity); // 165 to 0 (green)
          const b = Math.round(166 + (0 - 166) * intensity); // 166 to 0 (blue)

          diffElement.style.background = `rgb(${r}, ${g}, ${b})`;
          diffElement.style.color = intensity > 0.5 ? "white" : "#2c3e50";
        }

        // Determine which atom is more electronegative
        const moreElectronegative = en1 > en2 ? "left" : "right";

        // Get cloud elements
        const cloud = document.getElementById("electron-cloud");
        const ionicCloudLeft = document.getElementById("ionic-cloud-left");
        const ionicCloudRight = document.getElementById("ionic-cloud-right");
        const chargeLeft = document.getElementById("charge-left");
        const chargeRight = document.getElementById("charge-right");
        const bondType = document.getElementById("bond-type");

        if (diff < 0.001) {
          // Exactly equal - crossed zero
          cloud.style.display = "block";
          ionicCloudLeft.style.display = "none";
          ionicCloudRight.style.display = "none";
          cloud.style.background = "linear-gradient(90deg, #ddd 0%, #ddd 100%)";
          chargeLeft.textContent = "⌀";
          chargeRight.textContent = "⌀";
          chargeLeft.style.fontSize = "16px";
          chargeRight.style.fontSize = "16px";
          chargeLeft.style.color = "#7f8c8d";
          chargeRight.style.color = "#7f8c8d";
          bondType.textContent = "Nonpolar Covalent";
          bondType.className = "bond-type nonpolar";
        } else if (diff < 0.4) {
          // Nonpolar - tiny gray δ symbols
          cloud.style.display = "block";
          ionicCloudLeft.style.display = "none";
          ionicCloudRight.style.display = "none";
          cloud.style.background = "linear-gradient(90deg, #ddd 0%, #ddd 100%)";

          if (moreElectronegative === "left") {
            chargeLeft.textContent = "δ−";
            chargeRight.textContent = "δ+";
          } else {
            chargeLeft.textContent = "δ+";
            chargeRight.textContent = "δ−";
          }

          chargeLeft.style.fontSize = "8px";
          chargeRight.style.fontSize = "8px";
          chargeLeft.style.color = "#bdc3c7";
          chargeRight.style.color = "#bdc3c7";
          bondType.textContent = "Nonpolar Covalent";
          bondType.className = "bond-type nonpolar";
        } else if (diff >= 0.4 && diff < 1.7) {
          // Polar covalent with distinct strength levels
          cloud.style.display = "block";
          ionicCloudLeft.style.display = "none";
          ionicCloudRight.style.display = "none";

          let opacity, fontSize;

          if (diff < 0.8) {
            // Weakly polar - light, subtle colors
            opacity = 0.25 + (diff - 0.4) * 0.25; // 0.25 to 0.35
            fontSize = 14 + (diff - 0.4) * 12.5; // 14px to 19px
          } else if (diff < 1.2) {
            // Moderately polar - medium colors
            opacity = 0.4 + (diff - 0.8) * 0.25; // 0.4 to 0.5
            fontSize = 20 + (diff - 0.8) * 12.5; // 20px to 25px
          } else if (diff < 1.6) {
            // Strongly polar - strong colors
            opacity = 0.6 + (diff - 1.2) * 0.25; // 0.6 to 0.7
            fontSize = 26 + (diff - 1.2) * 10; // 26px to 30px
          } else {
            // Very strongly polar - very strong colors, approaching ionic
            opacity = 0.75 + (diff - 1.6) * 0.125; // 0.75 to 0.8
            fontSize = 32 + (diff - 1.6) * 15; // 32px to 35px
          }

          if (moreElectronegative === "left") {
            cloud.style.background = `linear-gradient(90deg, rgba(255,0,0,${opacity}) 0%, rgba(0,100,255,${opacity}) 100%)`;
            chargeLeft.textContent = "δ−";
            chargeRight.textContent = "δ+";
            chargeLeft.style.color = "#ff0000";
            chargeRight.style.color = "#0064ff";
          } else {
            cloud.style.background = `linear-gradient(90deg, rgba(0,100,255,${opacity}) 0%, rgba(255,0,0,${opacity}) 100%)`;
            chargeLeft.textContent = "δ+";
            chargeRight.textContent = "δ−";
            chargeLeft.style.color = "#0064ff";
            chargeRight.style.color = "#ff0000";
          }

          chargeLeft.style.fontSize = fontSize + "px";
          chargeRight.style.fontSize = fontSize + "px";
          bondType.textContent = "Polar Covalent";
          bondType.className = "bond-type polar";
        } else {
          // Ionic - show separate clouds instead of single cloud
          cloud.style.display = "none";
          ionicCloudLeft.style.display = "block";
          ionicCloudRight.style.display = "block";

          if (moreElectronegative === "left") {
            // Left atom gets extra electrons (negative), right loses electrons (positive)
            ionicCloudLeft.style.background =
              "radial-gradient(circle, rgba(255,0,0,0.9) 0%, rgba(255,100,100,0.6) 60%, rgba(255,150,150,0.3) 100%)";
            ionicCloudRight.style.background =
              "radial-gradient(circle, rgba(0,100,255,0.7) 0%, rgba(100,150,255,0.4) 60%, rgba(150,180,255,0.2) 100%)";
            ionicCloudLeft.style.width = "140px";
            ionicCloudLeft.style.height = "140px";
            ionicCloudRight.style.width = "100px";
            ionicCloudRight.style.height = "100px";
            ionicCloudLeft.style.transform = "translateX(-195px)";
            ionicCloudRight.style.transform = "translateX(75px)";
            chargeLeft.textContent = "−";
            chargeRight.textContent = "+";
            chargeLeft.style.color = "#ff0000";
            chargeRight.style.color = "#0064ff";
          } else {
            // Right atom gets extra electrons (negative), left loses electrons (positive)
            ionicCloudLeft.style.background =
              "radial-gradient(circle, rgba(0,100,255,0.7) 0%, rgba(100,150,255,0.4) 60%, rgba(150,180,255,0.2) 100%)";
            ionicCloudRight.style.background =
              "radial-gradient(circle, rgba(255,0,0,0.9) 0%, rgba(255,100,100,0.6) 60%, rgba(255,150,150,0.3) 100%)";
            ionicCloudLeft.style.width = "100px";
            ionicCloudLeft.style.height = "100px";
            ionicCloudRight.style.width = "140px";
            ionicCloudRight.style.height = "140px";
            ionicCloudLeft.style.transform = "translateX(-175px)";
            ionicCloudRight.style.transform = "translateX(55px)";
            chargeLeft.textContent = "+";
            chargeRight.textContent = "−";
            chargeLeft.style.color = "#0064ff";
            chargeRight.style.color = "#ff0000";
          }

          chargeLeft.style.fontSize = "42px";
          chargeRight.style.fontSize = "42px";
          bondType.textContent = "Ionic";
          bondType.className = "bond-type ionic";
        }
      }

      let selectedAtoms = {
        "intro-atom1": "H",
        "intro-atom2": "F",
        "full-atom1": "H",
        "full-atom2": "F",
      };

      let currentView = "cloud";
      let electronAnimation = null;
      let electrons = [];

      // Initialize electron positions
      function initializeElectrons() {
        electrons = [
          { id: "electron-1", x: 150, y: 80, vx: 7.5, vy: 4.5 },
          { id: "electron-2", x: 200, y: 100, vx: -4.5, vy: 6.0 },
        ];
      }

      function switchView(view) {
        currentView = view;

        // Update toggle buttons
        document
          .querySelectorAll(".toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        const cloudView = document.getElementById("electron-cloud");
        const ionicCloudLeft = document.getElementById("ionic-cloud-left");
        const ionicCloudRight = document.getElementById("ionic-cloud-right");
        const dotsView = document.getElementById("electron-dots-view");

        if (view === "cloud") {
          dotsView.style.display = "none";
          if (electronAnimation) {
            cancelAnimationFrame(electronAnimation);
            electronAnimation = null;
          }
          // Update visualization to show appropriate clouds
          if (currentMode === "intro") {
            updateBondFromIntro();
          } else if (currentMode === "atoms") {
            updateBondFromFull();
          } else {
            updateBondFromSliders();
          }
        } else {
          cloudView.style.display = "none";
          ionicCloudLeft.style.display = "none";
          ionicCloudRight.style.display = "none";
          dotsView.style.display = "block";
          initializeElectrons(); // Reset electron positions
          animateElectrons();
        }
      }

      function animateElectrons() {
        if (currentView !== "dots") return;

        const en1 = electronegativity[selectedAtoms["intro-atom1"]];
        const en2 = electronegativity[selectedAtoms["intro-atom2"]];
        const diff = Math.abs(en2 - en1);

        // Atom positions
        const atom1X = 125; // Left atom center
        const atom2X = 325; // Right atom center
        const atomY = 100; // Both atoms Y center

        // Determine which atom is more electronegative
        const moreElectronegativeLeft = en1 > en2;
        const lessElectronegativeLeft = en1 < en2;

        electrons.forEach((electron) => {
          const el = document.getElementById(electron.id);

          // Update position with current velocity
          electron.x += electron.vx;
          electron.y += electron.vy;

          // Calculate distances to both atoms
          const distToAtom1 = Math.sqrt(
            (electron.x - atom1X) ** 2 + (electron.y - atomY) ** 2
          );
          const distToAtom2 = Math.sqrt(
            (electron.x - atom2X) ** 2 + (electron.y - atomY) ** 2
          );

          // Create attraction forces to both atoms
          const baseAttraction = 0.025; // Increased 3x from 0.01
          const electronegativityBonus = diff * 0.06; // Increased stronger bias (4x from 0.015)

          // Both atoms attract electrons, but electronegative one attracts more
          let atom1Attraction = baseAttraction;
          let atom2Attraction = baseAttraction;

          if (moreElectronegativeLeft) {
            atom1Attraction += electronegativityBonus;
          } else if (lessElectronegativeLeft) {
            atom2Attraction += electronegativityBonus;
          }

          // Apply attraction forces toward both atoms
          if (distToAtom1 > 15) {
            // Reduced threshold so they get closer
            const atom1ForceX =
              ((atom1X - electron.x) / distToAtom1) * atom1Attraction;
            const atom1ForceY =
              ((atomY - electron.y) / distToAtom1) * atom1Attraction;
            electron.vx += atom1ForceX;
            electron.vy += atom1ForceY;
          }

          if (distToAtom2 > 15) {
            // Reduced threshold so they get closer
            const atom2ForceX =
              ((atom2X - electron.x) / distToAtom2) * atom2Attraction;
            const atom2ForceY =
              ((atomY - electron.y) / distToAtom2) * atom2Attraction;
            electron.vx += atom2ForceX;
            electron.vy += atom2ForceY;
          }

          // Add some randomness for natural movement (increased for more dynamic motion)
          electron.vx += (Math.random() - 0.5) * 1.2; // Increased 3x from 0.4
          electron.vy += (Math.random() - 0.5) * 1.2;

          // Boundary collision detection (elliptical bounds)
          const centerX = 225;
          const centerY = 100;
          const radiusX = 200;
          const radiusY = 85;

          const normalizedX = (electron.x - centerX) / radiusX;
          const normalizedY = (electron.y - centerY) / radiusY;
          const distanceFromCenter = Math.sqrt(
            normalizedX * normalizedX + normalizedY * normalizedY
          );

          if (distanceFromCenter > 0.9) {
            // Bounce off boundary with more force for faster electrons
            electron.vx *= -0.9;
            electron.vy *= -0.9;

            // Move back inside
            electron.x =
              centerX + (normalizedX / distanceFromCenter) * radiusX * 0.85;
            electron.y =
              centerY + (normalizedY / distanceFromCenter) * radiusY * 0.85;
          }

          // Speed limiting - keep reasonable movement
          const speed = Math.sqrt(
            electron.vx * electron.vx + electron.vy * electron.vy
          );
          if (speed > 18.0) {
            // Increased 3x from 6.0
            electron.vx = (electron.vx / speed) * 18.0;
            electron.vy = (electron.vy / speed) * 18.0;
          }

          // Apply slight friction
          electron.vx *= 0.992; // Slightly more friction to control the faster movement
          electron.vy *= 0.992;

          // Update DOM element position
          el.style.left = electron.x + "px";
          el.style.top = electron.y + "px";
        });

        electronAnimation = requestAnimationFrame(animateElectrons);
      }

      function selectAtom(atomSlot, element, clickedBox) {
        // Update selection
        selectedAtoms[atomSlot] = element;

        // Update visual selection for this atom slot
        const parentSelector = clickedBox.closest(".atom-selector-visual");

        // Remove 'selected' class from all boxes in this group
        parentSelector.querySelectorAll(".element-box").forEach((box) => {
          box.classList.remove("selected");
        });

        // Add 'selected' class to clicked box
        clickedBox.classList.add("selected");

        // Update the bond visualization based on which mode we're in
        if (atomSlot.startsWith("intro-")) {
          updateBondFromIntro();
          // Reset electrons if in moving electrons view
          if (currentView === "dots") {
            initializeElectrons();
          }
        } else if (atomSlot.startsWith("full-")) {
          updateBondFromFull();
        }
      }

      function updateBondFromIntro() {
        const atom1 = selectedAtoms["intro-atom1"];
        const atom2 = selectedAtoms["intro-atom2"];
        const en1 = electronegativity[atom1];
        const en2 = electronegativity[atom2];
        updateBondVisualization(en1, en2, atom1, atom2);
      }

      function updateBondFromFull() {
        const atom1 = selectedAtoms["full-atom1"];
        const atom2 = selectedAtoms["full-atom2"];
        const en1 = electronegativity[atom1];
        const en2 = electronegativity[atom2];
        updateBondVisualization(en1, en2, atom1, atom2);
      }

      function updateBondFromSliders() {
        const en1 = parseFloat(document.getElementById("en-slider-1").value);
        const en2 = parseFloat(document.getElementById("en-slider-2").value);

        // Update slider value displays
        document.getElementById("en-value-1").textContent = en1.toFixed(2);
        document.getElementById("en-value-2").textContent = en2.toFixed(2);

        updateBondVisualization(en1, en2, "A", "B");
      }

      // Add event listeners
      document
        .getElementById("show-bond-type")
        .addEventListener("change", updateBondTypeVisibility);
      document
        .getElementById("en-slider-1")
        .addEventListener("input", updateBondFromSliders);
      document
        .getElementById("en-slider-2")
        .addEventListener("input", updateBondFromSliders);

      // Initialize
      updateBondFromIntro();
      updateBondTypeVisibility();
      initializeElectrons();
    </script>
  </body>
</html>
